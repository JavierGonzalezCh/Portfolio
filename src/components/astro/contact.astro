---
import SocialLinks from "./socialLinks.astro";

const CONTACT_INFO = {
  email: "javiergo.2502@gmail.com",
  socials: [
    {
      name: "LinkedIn",
      url: "https://linkedin.com/in/tu-usuario",
      icon: "linkedin",
    },
    { name: "GitHub", url: "https://github.com/tu-usuario", icon: "github" },
    {
      name: "Whatsapp",
      url: "https://twitter.com/tu-usuario",
      icon: "terminal",
    },
  ],
};

const FORMSPREE_URL = "https://formspree.io/f/xwvnbqey";
---

<section
  id="contact"
  class="relative bg-[#0a0a0a] pt-10 pb-16 overflow-hidden group/section"
>
  <div
    class="absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-[#0a0a0a] to-transparent z-10 pointer-events-none"
  >
  </div>
  <div
    class="absolute top-1/2 left-0 -translate-y-1/2 w-[500px] h-[500px] bg-tech-orange/5 blur-[120px] rounded-full pointer-events-none"
  >
  </div>

  <div class="max-w-7xl mx-auto px-6 lg:px-12 relative z-20">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24">
      <div
        class="reveal-on-scroll opacity-0 translate-y-8 transition-all duration-1000 ease-out"
      >
        <h2
          class="text-3xl md:text-5xl font-serif font-bold text-white leading-tight mb-8"
        >
          Iniciemos algo <br />
          <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-tech-gold via-tech-orange to-tech-gold bg-[size:200%_auto] animate-gradient-x"
          >
            Extraordinario
          </span>
        </h2>

        <p
          class="text-lg text-tech-text-secondary leading-relaxed max-w-lg mb-12 font-light"
        >
          Estoy listo para transformar ideas complejas en arquitecturas de
          software escalables. Si buscas un socio técnico que entienda tanto de
          código como de negocio, hablemos.
        </p>

        <div class="mb-12">
          <p
            class="text-xs text-gray-500 uppercase tracking-widest font-bold mb-4 font-mono"
          >
            Correo Electrónico
          </p>

          <button
            id="copy-email-btn"
            class="group relative flex items-center gap-4 p-4 pr-6 rounded-2xl bg-[#0a0a0a] border border-white/10 hover:border-tech-gold/30 hover:bg-white/10 transition-all duration-300 w-full md:w-auto cursor-pointer text-left"
            data-email={CONTACT_INFO.email}
            aria-label="Copiar correo electrónico"
          >
            <div
              class="p-3 rounded-xl bg-black/30 text-tech-gold border border-white/5 flex-shrink-0"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><rect width="20" height="16" x="2" y="4" rx="2"></rect><path
                  d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg
              >
            </div>

            <span
              class="text-lg md:text-xl text-white font-mono tracking-wide break-all"
              >{CONTACT_INFO.email}</span
            >

            <div
              class="ml-auto text-gray-500 group-hover:text-white transition-colors relative pl-4"
            >
              <span
                class="icon-copy block transition-all duration-300 scale-100 opacity-100"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  ><rect width="14" height="14" x="8" y="8" rx="2" ry="2"
                  ></rect><path
                    d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"
                  ></path></svg
                >
              </span>
              <span
                class="icon-check absolute top-0 left-4 text-green-400 transition-all duration-300 scale-0 opacity-0"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg
                >
              </span>
            </div>

            <span
              id="copy-tooltip"
              class="absolute -top-10 right-0 text-xs text-green-400 font-mono bg-green-400/10 px-3 py-1.5 rounded border border-green-400/20 opacity-0 transition-opacity duration-300 pointer-events-none transform translate-y-2"
            >
              ¡Copiado!
            </span>
          </button>
        </div>

        {/* --- REDES SOCIALES --- */}
        <div>
          <p
            class="text-xs text-gray-500 uppercase tracking-widest font-bold mb-4 font-mono"
          >
            Encuéntrame en
          </p>

          <SocialLinks items={CONTACT_INFO.socials} />
        </div>
      </div>

      <div
        class="relative reveal-on-scroll opacity-0 translate-y-12 transition-all duration-1000 ease-out delay-200"
      >
        <div
          class="relative p-8 md:p-10 rounded-3xl bg-[#0a0a0a] border border-white/10 shadow-2xl overflow-hidden min-h-[500px] flex flex-col justify-center"
        >
          <div
            class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-tech-gold to-transparent opacity-50"
          >
          </div>

          <div
            id="success-message"
            class="hidden flex-col items-center justify-center text-center animate-fade-in absolute inset-0 z-20 bg-[#121212]"
          >
            <div
              class="w-20 h-20 rounded-full bg-green-500/10 flex items-center justify-center mb-6 border border-green-500/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="40"
                height="40"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-green-500"><path d="M20 6 9 17l-5-5"></path></svg
              >
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">
              ¡Mensaje Enviado!
            </h3>
            <p class="text-gray-400 max-w-xs mx-auto mb-8">
              He recibido tu correo correctamente. Te contestaré a la mayor
              brevedad posible.
            </p>
            <button
              id="reset-form-btn"
              class="text-sm text-tech-gold hover:underline underline-offset-4 cursor-pointer transition-colors hover:text-white"
            >
              Enviar otro mensaje
            </button>
          </div>

          <div
            id="error-message"
            class="hidden flex-col items-center justify-center text-center animate-fade-in absolute inset-0 z-20 bg-[#121212]"
          >
            <div
              class="w-20 h-20 rounded-full bg-red-500/10 flex items-center justify-center mb-6 border border-red-500/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="40"
                height="40"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-red-500"
                ><circle cx="12" cy="12" r="10"></circle><line
                  x1="12"
                  x2="12"
                  y1="8"
                  y2="12"></line><line x1="12" x2="12.01" y1="16" y2="16"
                ></line></svg
              >
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">Ups, algo falló</h3>
            <p class="text-gray-400 max-w-xs mx-auto mb-8">
              No se pudo enviar el mensaje. Por favor intenta de nuevo o
              escríbeme directamente al email.
            </p>
            <button
              id="retry-btn"
              class="text-sm text-tech-orange hover:underline underline-offset-4 cursor-pointer transition-colors hover:text-white"
            >
              Intentar de nuevo
            </button>
          </div>

          <form
            id="contact-form"
            action={FORMSPREE_URL}
            method="POST"
            class="space-y-6 relative z-10"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-2">
                <label
                  for="name"
                  class="text-xs font-mono text-gray-500 uppercase"
                  >Tu Nombre</label
                >
                <input
                  type="text"
                  name="name"
                  id="name"
                  required
                  class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-tech-gold/50 focus:ring-1 focus:ring-tech-gold/20 transition-all placeholder:text-white/20"
                  placeholder="Ej. Juan Pérez"
                />
              </div>
              <div class="space-y-2">
                <label
                  for="email"
                  class="text-xs font-mono text-gray-500 uppercase"
                  >Tu Email</label
                >
                <input
                  type="email"
                  name="email"
                  id="email"
                  required
                  class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-tech-gold/50 focus:ring-1 focus:ring-tech-gold/20 transition-all placeholder:text-white/20"
                  placeholder="juan@empresa.com"
                />
              </div>
            </div>

            <div class="space-y-2">
              <label
                for="subject"
                class="text-xs font-mono text-gray-500 uppercase">Asunto</label
              >
              <div class="relative">
                <select
                  name="subject"
                  id="subject"
                  class="w-full border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-tech-gold/50 focus:ring-1 focus:ring-tech-gold/20 transition-all appearance-none cursor-pointer"
                >
                  <option
                    class="text-white bg-[#0a0a0a]"
                    value="Propuesta de Proyecto">Propuesta de Proyecto</option
                  >
                  <option
                    class="text-white bg-[#0a0a0a]"
                    value="Consultoría Técnica">Consultoría Técnica</option
                  >
                  <option
                    class="text-white bg-[#0a0a0a]"
                    value="Oportunidad Laboral">Oportunidad Laboral</option
                  >
                  <option class="text-white bg-[#0a0a0a]" value="Otro"
                    >Otro</option
                  >
                </select>
                <div
                  class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg
                  >
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label
                for="message"
                class="text-xs font-mono text-gray-500 uppercase">Mensaje</label
              >
              <textarea
                name="message"
                id="message"
                required
                rows="4"
                class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-tech-gold/50 focus:ring-1 focus:ring-tech-gold/20 transition-all placeholder:text-white/20 resize-none"
                placeholder="Cuéntame sobre tu proyecto o desafío técnico..."
              ></textarea>
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="w-full group relative flex items-center justify-center gap-2 bg-gradient-to-r from-tech-orange to-tech-gold hover:from-orange-500 hover:to-yellow-500 text-black font-bold py-4 rounded-xl transition-all duration-300 overflow-hidden cursor-pointer disabled:opacity-70 disabled:cursor-not-allowed mt-2"
            >
              <span
                class="btn-text text-white relative z-10 flex items-center gap-2"
              >
                Enviar Mensaje
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"
                  ><path d="m22 2-7 20-4-9-9-4Z"></path><path d="M22 2 11 13"
                  ></path></svg
                >
              </span>

              <span class="btn-loader hidden items-center gap-2 relative z-10">
                <span
                  class="w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"
                ></span>
                Enviando...
              </span>

              <div
                class="absolute inset-0 -translate-x-full group-hover:animate-shimmer bg-gradient-to-r from-transparent via-white/30 to-transparent z-0"
              >
              </div>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .reveal-active {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }

  @keyframes fade-in {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.5s ease-out forwards;
  }
</style>

{/* --- LÓGICA JAVASCRIPT --- */}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1. SCROLL REVEAL (Aparición al hacer scroll)
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("reveal-active");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 },
    );

    document
      .querySelectorAll(".reveal-on-scroll")
      .forEach((el) => observer.observe(el));

    // 2. COPIAR EMAIL AL PORTAPAPELES
    const copyBtn = document.getElementById("copy-email-btn");
    const copyTooltip = document.getElementById("copy-tooltip");
    const iconCopy = document.querySelector(".icon-copy");
    const iconCheck = document.querySelector(".icon-check");

    if (copyBtn && copyTooltip) {
      copyBtn.addEventListener("click", () => {
        const email = copyBtn.getAttribute("data-email");
        if (email) navigator.clipboard.writeText(email);

        // Feedback visual
        copyTooltip.classList.remove("opacity-0", "translate-y-2");
        copyTooltip.classList.add("-translate-y-1");

        iconCopy?.classList.add("scale-0", "opacity-0");
        iconCheck?.classList.remove("scale-0", "opacity-0");
        iconCheck?.classList.add("scale-100", "opacity-100");

        setTimeout(() => {
          copyTooltip.classList.add("opacity-0", "translate-y-2");
          copyTooltip.classList.remove("-translate-y-1");

          iconCopy?.classList.remove("scale-0", "opacity-0");
          iconCheck?.classList.add("scale-0", "opacity-0");
          iconCheck?.classList.remove("scale-100", "opacity-100");
        }, 2000);
      });
    }

    // 3. MANEJO DEL FORMULARIO (AJAX)
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const successMsg = document.getElementById("success-message");
    const errorMsg = document.getElementById("error-message");
    const submitBtn = document.getElementById(
      "submit-btn",
    ) as HTMLButtonElement;
    const btnText = submitBtn?.querySelector(".btn-text");
    const btnLoader = submitBtn?.querySelector(".btn-loader");
    const resetBtn = document.getElementById("reset-form-btn");
    const retryBtn = document.getElementById("retry-btn");

    async function handleFormSubmit(event: SubmitEvent) {
      event.preventDefault(); // Evitar recarga de página

      // Activar estado de carga
      if (submitBtn) submitBtn.disabled = true;
      btnText?.classList.add("hidden");
      btnLoader?.classList.remove("hidden");
      btnLoader?.classList.add("flex");

      const formData = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData,
          headers: {
            Accept: "application/json",
          },
        });

        if (response.ok) {
          // ÉXITO
          form.classList.add("hidden");
          successMsg?.classList.remove("hidden");
          successMsg?.classList.add("flex");
          form.reset();
        } else {
          throw new Error("Error en el envío");
        }
      } catch (error) {
        // ERROR
        form.classList.add("hidden");
        errorMsg?.classList.remove("hidden");
        errorMsg?.classList.add("flex");
      } finally {
        // Restaurar botón
        if (submitBtn) submitBtn.disabled = false;
        btnText?.classList.remove("hidden");
        btnLoader?.classList.add("hidden");
        btnLoader?.classList.remove("flex");
      }
    }

    if (form) {
      form.addEventListener("submit", handleFormSubmit);

      // Botón "Enviar otro"
      resetBtn?.addEventListener("click", () => {
        successMsg?.classList.add("hidden");
        successMsg?.classList.remove("flex");
        form.classList.remove("hidden");
        form.classList.add("animate-fade-in");
      });

      // Botón "Reintentar"
      retryBtn?.addEventListener("click", () => {
        errorMsg?.classList.add("hidden");
        errorMsg?.classList.remove("flex");
        form.classList.remove("hidden");
        form.classList.add("animate-fade-in");
      });
    }
  });
</script>
